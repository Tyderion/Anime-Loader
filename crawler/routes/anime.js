"use strict";
var express = require('express');
var fuzzy = require('fuzzy');
var router = express.Router();
var animelist = [];
var animeMap = {};
var crawler = require('../crawler');
crawler.getAll(false).then(anime => {
    animelist = anime;
    animelist.forEach((anime, index) => {
        animeMap[anime.id] = index;
    });
})


/* GET users listing. */
router.get('/', function (req, res, next) {
    res.setHeader('Access-Control-Allow-Origin', '*');
    var start = 0, length = animelist.length > 40 ? 40 : animelist.length;
    if (req.query.start) {
        start = req.query.start;
    }
    if (req.query.length) {
        length = req.query.length;
    }
    res.json(animelist.slice(start, length));
});

function getAnime(id) {
    return animelist[animeMap[id]];
}

router.get('/:id', function (req, res, next) {
        res.setHeader('Access-Control-Allow-Origin', '*');
        res.json(getAnime(req.params.id));
    }
);

router.get('/load/:id', function (req, res, next) {
        res.setHeader('Access-Control-Allow-Origin', '*');
    //res.json({"720":["http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_01_(BD_720p)_(Shiro).mkv","http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_02_(BD_720p)_(Shiro).mkv","http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_03_(BD_720p)_(Shiro).mkv","http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_04_(BD_720p)_(Shiro).mkv","http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_05_(BD_720p)_(Shiro).mkv","http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_06_(BD_720p)_(Shiro).mkv","http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_07_(BD_720p)_(Shiro).mkv","http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_08_(BD_720p)_(Shiro).mkv","http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_09_(BD_720p)_(Shiro).mkv","http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_10_(BD_720p)_(Shiro).mkv","http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_11_(BD_720p)_(Shiro).mkv","http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_12_(BD_720p)_(Shiro).mkv","http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_13_(BD_720p)_(Shiro).mkv","http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_14_(BD_720p)_(Shiro).mkv","http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_15_(BD_720p)_(Shiro).mkv","http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_16_(BD_720p)_(Shiro).mkv","http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_17_(BD_720p)_(Shiro).mkv","http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_18_(BD_720p)_(Shiro).mkv","http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_19_(BD_720p)_(Shiro).mkv","http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_20_(BD_720p)_(Shiro).mkv","http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_21_(BD_720p)_(Shiro).mkv","http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_22_(BD_720p)_(Shiro).mkv","http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_23_(BD_720p)_(Shiro).mkv","http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_24_(BD_720p)_(Shiro).mkv","http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_25_(BD_720p)_(Shiro).mkv","http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_ED2_(BD_720p)_(Shiro).mkv","http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_ED_(BD_720p)_(Shiro).mkv"],"1080":["http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_01_(BD_1080p)_(UTW)_(CAD808A9).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_02_(BD_1080p)_(UTW)_(EFCB7287).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_03_(BD_1080p)_(UTW)_(700138C9).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_04_(BD_1080p)_(UTW)_(BCBE82D6).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_05_(BD_1080p)_(UTW)_(D8DB718E).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_06_(BD_1080p)_(UTW)_(E35B42F6).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_07_(BD_1080p)_(UTW)_(95B4170B).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_08_(BD_1080p)_(UTW)_(AE8A6CA0).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_09_(BD_1080p)_(UTW)_(0DDEF8F8).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_10_(BD_1080p)_(UTW)_(39EDC9CF).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_11_(BD_1080p)_(UTW)_(78F0D240).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_12_(BD_1080p)_(UTW)_(D51F0288).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_13_(BD_1080p)_(UTW)_(550061EA).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_14_(BD_1080p)_(UTW)_(6E5BBC54).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_15_(BD_1080p)_(UTW)_(0E827AB1).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_16_(BD_1080p)_(UTW)_(C9FC8895).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_17_(BD_1080p)_(Airota&DHR-UTW)_(6C81209E).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_18_(BD_1080p)_(Airota&DHR-UTW)_(E71DBBCF).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_19_(BD_1080p)_(Airota&DHR-UTW)_(72149BE4).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_20_(BD_1080p)_(Airota&DHR-UTW)_(E2F316EF).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_21_(BD_1080p)_(Airota&DHR-UTW)_(3E61526F).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_22_(BD_1080p)_(Airota&DHR-UTW)_(ED7F244A).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_23_(BD_1080p)_(Airota&DHR-UTW)_(BE4FC7DB).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_24_(BD_1080p)_(Airota&DHR-UTW)_(C539DF35).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_25_(BD_1080p)_(Airota&DHR-UTW)_(38A164FF).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_ED_01_(BD_1080p)_(UTW)_(B80FF00C).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_ED_02_(BD_1080p)_(Airota&DHR-UTW)_(2D24E8CF).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_NCED_01_(BD_1080p)_(UTW)_(C79B68F1).mkv","http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_NCED_02_(BD_1080p)_(=^_^=)_(A00BCD33).mkv"],"others":[]});
res.json({"720":[{"title":0,"link":"http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_01_(BD_720p)_(Shiro).mkv"},{"title":1,"link":"http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_02_(BD_720p)_(Shiro).mkv"},{"title":2,"link":"http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_03_(BD_720p)_(Shiro).mkv"},{"title":3,"link":"http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_04_(BD_720p)_(Shiro).mkv"},{"title":4,"link":"http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_05_(BD_720p)_(Shiro).mkv"},{"title":5,"link":"http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_06_(BD_720p)_(Shiro).mkv"},{"title":6,"link":"http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_07_(BD_720p)_(Shiro).mkv"},{"title":7,"link":"http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_08_(BD_720p)_(Shiro).mkv"},{"title":8,"link":"http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_09_(BD_720p)_(Shiro).mkv"},{"title":9,"link":"http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_10_(BD_720p)_(Shiro).mkv"},{"title":10,"link":"http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_11_(BD_720p)_(Shiro).mkv"},{"title":11,"link":"http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_12_(BD_720p)_(Shiro).mkv"},{"title":12,"link":"http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_13_(BD_720p)_(Shiro).mkv"},{"title":13,"link":"http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_14_(BD_720p)_(Shiro).mkv"},{"title":14,"link":"http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_15_(BD_720p)_(Shiro).mkv"},{"title":15,"link":"http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_16_(BD_720p)_(Shiro).mkv"},{"title":16,"link":"http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_17_(BD_720p)_(Shiro).mkv"},{"title":17,"link":"http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_18_(BD_720p)_(Shiro).mkv"},{"title":18,"link":"http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_19_(BD_720p)_(Shiro).mkv"},{"title":19,"link":"http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_20_(BD_720p)_(Shiro).mkv"},{"title":20,"link":"http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_21_(BD_720p)_(Shiro).mkv"},{"title":21,"link":"http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_22_(BD_720p)_(Shiro).mkv"},{"title":22,"link":"http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_23_(BD_720p)_(Shiro).mkv"},{"title":23,"link":"http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_24_(BD_720p)_(Shiro).mkv"},{"title":24,"link":"http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_25_(BD_720p)_(Shiro).mkv"},{"title":"Ending x","link":"http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_ED2_(BD_720p)_(Shiro).mkv"},{"title":"Ending x","link":"http://adf.ly/4400856/http://hi10anime.uni.cx/kazz/[Hi10]_Shinsekai_Yori_[BD_720p]/(Hi10)_From_the_New_World_-_ED_(BD_720p)_(Shiro).mkv"}],"1080":[{"title":0,"link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_01_(BD_1080p)_(UTW)_(CAD808A9).mkv"},{"title":1,"link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_02_(BD_1080p)_(UTW)_(EFCB7287).mkv"},{"title":2,"link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_03_(BD_1080p)_(UTW)_(700138C9).mkv"},{"title":3,"link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_04_(BD_1080p)_(UTW)_(BCBE82D6).mkv"},{"title":4,"link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_05_(BD_1080p)_(UTW)_(D8DB718E).mkv"},{"title":5,"link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_06_(BD_1080p)_(UTW)_(E35B42F6).mkv"},{"title":6,"link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_07_(BD_1080p)_(UTW)_(95B4170B).mkv"},{"title":7,"link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_08_(BD_1080p)_(UTW)_(AE8A6CA0).mkv"},{"title":8,"link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_09_(BD_1080p)_(UTW)_(0DDEF8F8).mkv"},{"title":"Ending x","link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_10_(BD_1080p)_(UTW)_(39EDC9CF).mkv"},{"title":10,"link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_11_(BD_1080p)_(UTW)_(78F0D240).mkv"},{"title":11,"link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_12_(BD_1080p)_(UTW)_(D51F0288).mkv"},{"title":12,"link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_13_(BD_1080p)_(UTW)_(550061EA).mkv"},{"title":13,"link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_14_(BD_1080p)_(UTW)_(6E5BBC54).mkv"},{"title":14,"link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_15_(BD_1080p)_(UTW)_(0E827AB1).mkv"},{"title":15,"link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_16_(BD_1080p)_(UTW)_(C9FC8895).mkv"},{"title":16,"link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_17_(BD_1080p)_(Airota&DHR-UTW)_(6C81209E).mkv"},{"title":17,"link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_18_(BD_1080p)_(Airota&DHR-UTW)_(E71DBBCF).mkv"},{"title":18,"link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_19_(BD_1080p)_(Airota&DHR-UTW)_(72149BE4).mkv"},{"title":19,"link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_20_(BD_1080p)_(Airota&DHR-UTW)_(E2F316EF).mkv"},{"title":20,"link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_21_(BD_1080p)_(Airota&DHR-UTW)_(3E61526F).mkv"},{"title":"Ending x","link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_22_(BD_1080p)_(Airota&DHR-UTW)_(ED7F244A).mkv"},{"title":22,"link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_23_(BD_1080p)_(Airota&DHR-UTW)_(BE4FC7DB).mkv"},{"title":23,"link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_24_(BD_1080p)_(Airota&DHR-UTW)_(C539DF35).mkv"},{"title":24,"link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_25_(BD_1080p)_(Airota&DHR-UTW)_(38A164FF).mkv"},{"title":"Ending x","link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_ED_01_(BD_1080p)_(UTW)_(B80FF00C).mkv"},{"title":"Ending x","link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_ED_02_(BD_1080p)_(Airota&DHR-UTW)_(2D24E8CF).mkv"},{"title":"Ending x","link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_NCED_01_(BD_1080p)_(UTW)_(C79B68F1).mkv"},{"title":"Ending x","link":"http://adf.ly/4400856/http://hi10anime.mooo.com/aborwx/Shows/[Hi10]_Shinsekai_Yori_[BD_1080p]/(Hi10)_Shinsekai_Yori_-_NCED_02_(BD_1080p)_(=^_^=)_(A00BCD33).mkv"}],"others":[]});
        //
        //crawler.get(getAnime(req.params.id).link).then((result) => {
        //    res.json(result);
        //}).catch(function (err) {
        //    res.status(500).send(err.message);
        //});
    //.catch(res.status(500).send.bind(res));

    }
);

router.post('/search', function (req, res, next) {
    var query = req.body.query;
    var useFuzzy = req.body.fuzzy | false;
    var options = {
        extract: function (el) {
            return el.title;
        }
    };
    var results;
    if (useFuzzy) {
        results = fuzzy.filter(query, animelist, options).map(el => el.original);
    } else {
        results = animelist.filter(anime => anime.title.toLowerCase().indexOf(query.toLowerCase()) !== -1);
    }
    res.setHeader('Access-Control-Allow-Origin', '*');
    //res.setHeader('Access-Control-Allow-Headers', 'Content-Type');
    res.json(results);//);
})

router.options('/search', function (req, res, next) {
    res.setHeader('Access-Control-Allow-Origin', '*');
    res.setHeader('Access-Control-Allow-Headers', 'Content-Type');
    next();
})

module.exports = router;
